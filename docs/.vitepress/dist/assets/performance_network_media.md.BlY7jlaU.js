import{_ as i,c as t,o as e,ae as s}from"./chunks/framework.Cd-3tpCq.js";const c=JSON.parse('{"title":"资源加载优化","description":"","frontmatter":{},"headers":[],"relativePath":"performance/network/media.md","filePath":"performance/network/media.md"}'),p={name:"performance/network/media.md"};function n(l,a,r,o,d,m){return e(),t("div",null,a[0]||(a[0]=[s(`<meta name="referrer" content="no-referrer"><h1 id="资源加载优化" tabindex="-1">资源加载优化 <a class="header-anchor" href="#资源加载优化" aria-label="Permalink to &quot;资源加载优化&quot;">​</a></h1><h2 id="图片资源优化" tabindex="-1">图片资源优化 <a class="header-anchor" href="#图片资源优化" aria-label="Permalink to &quot;图片资源优化&quot;">​</a></h2><blockquote><p>图片资源在我们业务中占比最重，对于性能的影响也是最为显著的</p></blockquote><h3 id="图片格式选择与对比" tabindex="-1">图片格式选择与对比： <a class="header-anchor" href="#图片格式选择与对比" aria-label="Permalink to &quot;图片格式选择与对比：&quot;">​</a></h3><blockquote><p>针对目前主流类型进行比较：</p></blockquote><ul><li><strong>webp</strong></li></ul><p>同时支持有损和无损压缩，支持透明度图片格式， 兼容性较差 压缩比高，大量图片场景适用<br>WebP 是未压缩照片的最佳格式（比 JPEG 小 1.42 倍，比 PNG 小 1.70 倍，比 AVIF 小 1.75 倍）</p><ul><li><strong>PNG</strong></li></ul><p>支持无损压缩，支持多级不透明度，尺寸通常较大，适用于线条明显，标志性强的图片应用场景。</p><ul><li><strong>JPG</strong></li></ul><p>压缩程度也可以调整,可以在质量和大小间平衡，不支持动画和透明度。 适用于高分辨率和大量渐变的大型、复杂、彩色图像。</p><p><a href="https://photutorial.com/image-format-comparison-statistics/" target="_blank" rel="noreferrer">以下是几种常用图片比对情况：</a></p><table tabindex="0"><thead><tr><th>图片类型</th><th>Alpha 通道</th><th>动画</th><th>编码性能</th><th>压缩</th><th>颜色支持</th><th>兼容</th></tr></thead><tbody><tr><td>JPG</td><td>不支持</td><td>不支持</td><td>较高</td><td>有损</td><td>直接色</td><td>ALL</td></tr><tr><td>PNG</td><td>支持</td><td>不支持</td><td>较高</td><td>无损</td><td>索引色(256)\\直接色</td><td>ALL</td></tr><tr><td>WebP</td><td>支持</td><td>支持</td><td>差</td><td>有损/无损</td><td>直接色</td><td>高版本</td></tr></tbody></table><p><img src="https://cdn.nlark.com/yuque/0/2023/svg/25670427/1689849449342-b0cfe3cd-1efb-44f3-85a7-040cd38e2f9b.svg#from=url&amp;id=oK5Oe&amp;originHeight=720&amp;originWidth=960&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><h3 id="图片加载优化" tabindex="-1">图片加载优化 <a class="header-anchor" href="#图片加载优化" aria-label="Permalink to &quot;图片加载优化&quot;">​</a></h3><h4 id="响应式图片" tabindex="-1">响应式图片 <a class="header-anchor" href="#响应式图片" aria-label="Permalink to &quot;响应式图片&quot;">​</a></h4><p>根据不同屏幕尺寸、DPR设备像素比提供合适的图片，在视网膜屏下，CSS像素大小图片会失真模糊（一倍图）</p><blockquote><p>设备独立像素 = CSS像素 设备像素 = 物理像素 DPR = 物理像素 / CSS像素 （&gt; 1 称为视网膜屏）</p></blockquote><p><strong>处理方案：</strong></p><ul><li>统一多倍图-高dpr设备与普通设备效果都兼容，但是资源过大（例如：<a href="https://www.ecoflow.com/cn/delta-2-portable-power-station" target="_blank" rel="noreferrer">ecoflow</a>使用方案）</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689897043935-3904ebff-3736-4f0c-939a-2d2e77770043.png#averageHue=%2349647e&amp;clientId=u7f6a169b-dcb0-4&amp;from=paste&amp;height=214&amp;id=ubed9f9f6&amp;originHeight=1377&amp;originWidth=2706&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;size=1210822&amp;status=done&amp;style=none&amp;taskId=u192be552-3e31-42ba-b380-3f04c860aa3&amp;title=&amp;width=420.22222900390625" alt=""></p><ul><li>媒体查询设置 - 代码太多，无法逐个设置</li></ul><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">#id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">xxx@2x.png</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@media</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (device-pixel-ratio: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  #id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">xxx@2x.png</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@media</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (device-pixel-ratio: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  #id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">xxx@3x.png</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>srcset 配合像素密度描述符x / picture（苹果官网）：该方案处理多倍图加载的同时也可以处理响应式布局的差异性，在不同视口可以加载指定图片资源</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689897606760-d6d1cea9-c5c9-4a36-80c3-98ee20311702.png#averageHue=%233e5252&amp;clientId=udad46c45-c730-4&amp;from=paste&amp;height=208&amp;id=u082ccd69&amp;originHeight=1323&amp;originWidth=2650&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;size=1052297&amp;status=done&amp;style=none&amp;taskId=u9f9eaac2-98b9-464f-b725-091f6c0c4d8&amp;title=&amp;width=417.22222900390625" alt="image.png"><br>优化：CDN自带图片裁切，可以根据使用场景以及屏幕尺寸加载裁切后的图片，图片可以上传多倍图，适用响应式图片根据设备dpr和屏幕尺寸进行裁切选择<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689899634754-10318578-0427-433f-9ef4-d6fb0d97bebb.png#averageHue=%23232221&amp;clientId=udad46c45-c730-4&amp;from=paste&amp;height=130&amp;id=u79deece1&amp;originHeight=292&amp;originWidth=1478&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;size=45249&amp;status=done&amp;style=none&amp;taskId=u6bb71445-7c8e-4093-97bc-e9fd6f0be62&amp;title=&amp;width=656.8888888888889" alt="image.png"></p><h4 id="图片懒加载" tabindex="-1">图片懒加载 <a class="header-anchor" href="#图片懒加载" aria-label="Permalink to &quot;图片懒加载&quot;">​</a></h4><p>未滚动到指定区域之中的图片不会被加载，实现方式有两种，<code>HTML 属性 loading</code> or <code>js实现</code></p><ul><li>loading lazy 实现 <code>&lt;img src=&quot;xxx.jpg&quot; loading=&quot;lazy&quot; alt&gt;</code> 简单便捷</li><li>js实现 监听滚动或者intersection observe等实现，目前我们采用的第三方库<a href="https://afarkas.github.io/lazysizes/index.html" target="_blank" rel="noreferrer">lazysizes</a>，相比较html属性，灵活性高(可以指定位置范围加载)，适用场景多(script、css、iframe、video等都适用)，拓展性强（可以添加骨架图、渐进式、低质量占位图等）</li></ul><blockquote><p>💡 Tips：DJI和apple均采用的js 懒加载</p></blockquote><p>未懒加载下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689815845907-d0d7b167-5445-4d82-ab2e-1e265f629359.png#averageHue=%23fdfcfb&amp;from=url&amp;height=299&amp;id=RdlvN&amp;originHeight=912&amp;originWidth=1070&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=&amp;width=350.22222900390625" alt=""><br>部分懒加载优化后：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689816336079-965958c5-b204-41d9-b31a-4f0a08c030b9.png#averageHue=%23fdfbfa&amp;from=url&amp;height=359&amp;id=YAOzD&amp;originHeight=808&amp;originWidth=774&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=&amp;width=344.22222900390625" alt=""><br>大图处理后：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689824235822-90a0ec5f-4afe-44bd-a8b4-32e2ca0c1c7e.png#averageHue=%23fdfbfa&amp;from=url&amp;height=267&amp;id=RDF5p&amp;originHeight=636&amp;originWidth=873&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=&amp;width=366.22222900390625" alt=""></p><h3 id="讨论与总结" tabindex="-1">讨论与总结 <a class="header-anchor" href="#讨论与总结" aria-label="Permalink to &quot;讨论与总结&quot;">​</a></h3><ul><li>图片懒加载： lazysizes(图片，video，iframe，script), 属性：loading = &quot;lazy&quot;（都加）</li><li>响应式图片（尺寸）picture-source 媒体查询/dpr （shopify支持自动裁切， aem?）</li><li>物料图片2x 建议优先webp</li></ul><h2 id="视频加载优化" tabindex="-1">视频加载优化 <a class="header-anchor" href="#视频加载优化" aria-label="Permalink to &quot;视频加载优化&quot;">​</a></h2><p>视频默认都是页面载入立即加载，在有视频的情况下，页面加载资源过大，可以使用 preload = none或者lazysizes等进行指定加载<br>但是部分情况下，需要视频自动播放，例如官网首页，userguide等，该情况可以使用懒加载配合scroll进行指定加载：案例-<a href="https://www.apple.com/ipad-pro/" target="_blank" rel="noreferrer">apple</a> / <a href="https://codepen.io/zzl-leo/pen/wvQXQjg" target="_blank" rel="noreferrer">自定义demo</a>动画自动加载，指定位置播放<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689900044897-3eacb506-f7c6-4c51-ab9f-bab654ca1a29.png#averageHue=%23ccd6d0&amp;clientId=udad46c45-c730-4&amp;from=paste&amp;height=173&amp;id=u01e66f60&amp;originHeight=1282&amp;originWidth=2907&amp;originalType=binary&amp;ratio=2.25&amp;rotation=0&amp;showTitle=false&amp;size=1053921&amp;status=done&amp;style=none&amp;taskId=uf5ac11dc-5ebc-4705-ac6d-b81f13d4bda&amp;title=&amp;width=392.22222900390625" alt="image.png"></p><h3 id="讨论与总结-1" tabindex="-1">讨论与总结 <a class="header-anchor" href="#讨论与总结-1" aria-label="Permalink to &quot;讨论与总结&quot;">​</a></h3><ul><li>需要自动播放：关键位置加载指定位置播放</li></ul><h2 id="iconfont图标字体加载使用-后续待确认" tabindex="-1">Iconfont图标字体加载使用(后续待确认) <a class="header-anchor" href="#iconfont图标字体加载使用-后续待确认" aria-label="Permalink to &quot;Iconfont图标字体加载使用(后续待确认)&quot;">​</a></h2><p>目前采用ali iconfont字体，缺点是无法按需加载，页面只使用了两个字体图标也必须加载整个字体包才行<br>优化：使用SVG替代：在snippts下创建对应的片段使用即可<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689903033755-14ed1099-9960-4efd-ace6-792bee1904e9.png#averageHue=%23a4754f&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=117&amp;id=u77be0238&amp;originHeight=117&amp;originWidth=1234&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32719&amp;status=done&amp;style=none&amp;taskId=u96d88cf4-c00b-4095-b37c-08aab0e7795&amp;title=&amp;width=1234" alt="image.png"></p><h3 id="讨论与总结-2" tabindex="-1">讨论与总结 <a class="header-anchor" href="#讨论与总结-2" aria-label="Permalink to &quot;讨论与总结&quot;">​</a></h3><ul><li>待确认aem是否支持snippet形式引用</li></ul><h2 id="js-css构建优化" tabindex="-1">JS&amp;CSS构建优化 <a class="header-anchor" href="#js-css构建优化" aria-label="Permalink to &quot;JS&amp;CSS构建优化&quot;">​</a></h2><p>shopify中复用的组件或者代码片段可以使用section或者snippts实现，开发过程很容易将css&amp;js在单文件中实现（liquid），这样导致的问题就是单个页面中多次复用一个模块时候会导致css以及js多次重载，造成重绘重排以及脚本执行错误等问题出现<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689903517991-621d6829-4cc3-4373-a3c6-704bada9c43f.png#averageHue=%23fdfbfa&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=256&amp;id=ue5200220&amp;originHeight=689&amp;originWidth=1094&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=145337&amp;status=done&amp;style=none&amp;taskId=u482b7c30-efc7-4eca-a17d-63f5be59409&amp;title=&amp;width=407" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689904092230-1f9e5960-9028-4326-89b1-745ebca14d98.png#averageHue=%23e7eed2&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=92&amp;id=u7db3b2f4&amp;originHeight=126&amp;originWidth=522&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14700&amp;status=done&amp;style=none&amp;taskId=u2b5b7f6c-2655-4e4f-9a30-b823e775b87&amp;title=&amp;width=383" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689904219857-335ea845-6a90-4802-8d06-465bad5edfd9.png#averageHue=%23e7c79b&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=173&amp;id=ub4834f12&amp;originHeight=173&amp;originWidth=626&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23574&amp;status=done&amp;style=none&amp;taskId=ude04818f-d1be-4b5f-b41a-c669f429f96&amp;title=&amp;width=626" alt="image.png"><br>优化建议：对于复用性较多的section或snippts可以采用esm引入，保持单一page模板对应一个js\\css入口</p><ul><li>现有3.0项目按照jscss分离esm导入形式（确定全局单例可单文件实现）</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689904371595-95f55543-805b-4805-b1eb-f4d1aa33ea38.png#averageHue=%23272220&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=70&amp;id=u4dddf634&amp;originHeight=70&amp;originWidth=569&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9451&amp;status=done&amp;style=none&amp;taskId=u43939188-0c92-470a-b02d-f213323079b&amp;title=&amp;width=569" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25670427/1689904387355-b9ca2d5d-7c6d-44f8-8078-576d7daa6c50.png#averageHue=%23292421&amp;clientId=u4a87bbf0-b8cb-4&amp;from=paste&amp;height=159&amp;id=u089d3b14&amp;originHeight=159&amp;originWidth=465&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23756&amp;status=done&amp;style=none&amp;taskId=udc84896c-3ecd-475c-8b5d-2ad15b17098&amp;title=&amp;width=465" alt="image.png"></p><h2 id="其它" tabindex="-1">其它 <a class="header-anchor" href="#其它" aria-label="Permalink to &quot;其它&quot;">​</a></h2><ul><li>js脚本加载尽量用异步方式async or defer，避免阻塞渲染</li><li>复杂计算或者运算结果尽量用闭包本地存储等缓存，提高用户体验</li><li>dom操作尽量避免重排，例如批量样式操作用通过样式类名实现等</li><li>第三方库按需引入等</li></ul>`,47)]))}const g=i(p,[["render",n]]);export{c as __pageData,g as default};
